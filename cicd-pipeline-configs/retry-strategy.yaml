# ============================================================================
# Retry Strategy Configuration
# ============================================================================
# Description: Defines retry policies for different pipeline stages
# Version: 1.0.0
# ============================================================================

retry_strategies:
  default:
    max_attempts: 3
    initial_delay_seconds: 5
    max_delay_seconds: 60
    backoff_multiplier: 2
    retry_on:
      - timeout
      - connection_error
      - rate_limit

  build:
    max_attempts: 3
    initial_delay_seconds: 5
    max_delay_seconds: 30
    retry_on:
      - npm_registry_error
      - yarn_lock_error
      - network_timeout
      - build_failure

  test:
    max_attempts: 3
    initial_delay_seconds: 3
    max_delay_seconds: 15
    retry_on:
      - test_timeout
      - database_connection
      - flaky_test

  deployment:
    max_attempts: 5
    initial_delay_seconds: 30
    max_delay_seconds: 300
    retry_on:
      - aws_throttling
      - deployment_timeout
      - health_check_failure
      - resource_conflict

  security_scan:
    max_attempts: 2
    initial_delay_seconds: 10
    max_delay_seconds: 30
    retry_on:
      - scanner_timeout
      - api_error

  cleanup:
    max_attempts: 2
    initial_delay_seconds: 5
    max_delay_seconds: 15
    retry_on:
      - resource_busy
      - cleanup_timeout

error_patterns:
  npm_registry_error:
    - "npm ERR! code E*"
    - "npm ERR! network"
    - "ECONNRESET"
    - "ETIMEDOUT"
  
  yarn_lock_error:
    - "Couldn't find package"
    - "YARN_LOCK_ERROR"
    - "Checksum mismatch"
  
  aws_throttling:
    - "ThrottlingException"
    - "RequestLimitExceeded"
    - "TooManyRequestsException"
  
  test_timeout:
    - "Test timeout"
    - "Async callback was not invoked"
    - "Timeout - Async function did not complete"

notification_settings:
  on_retry:
    enabled: true
    channels:
      - github_annotations
      - workflow_logs
  
  on_max_retries_exceeded:
    enabled: true
    channels:
      - github_annotations
      - workflow_logs
      - issue_comment

logging:
  retry_attempts: true
  retry_reasons: true
  timing_metrics: true
  success_after_retry: true